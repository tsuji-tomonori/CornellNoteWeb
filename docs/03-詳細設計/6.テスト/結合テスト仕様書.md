# 結合テスト仕様書（Playwright）

## 目的
- 主要ユースケースをE2E観点で検証し、FRの受入基準とNFR-DEV-006、PC-002（対応ブラウザ）を満たす。

## 対象範囲
- Webフロント（login/notes/editor/share）とAPIの結合
- 主要フロー: 認証、ノート作成/編集、自動保存、検索、共有、PDFエクスポート
- エラーハンドリング/画面遷移/アクセシビリティ通知

## 参照ドキュメント
- `docs/01-要件定義/3.機能要求(FR)/*`
- `docs/01-要件定義/2.プロジェクトの制約(PC)/PC-002.md`
- `docs/01-要件定義/2.プロジェクトの制約(PC)/PC-003.md`
- `docs/01-要件定義/4.非機能要求(NFR)/4.6.DevOps(DEV)/NFR-DEV-006.md`
- `docs/02-基本設計/4.API設計/API-Overview.md`
- `docs/03-詳細設計/1.UC別シーケンス/*`
- `docs/03-詳細設計/4.Frontend詳細/*`
- `docs/03-詳細設計/3.非機能詳細/DD-CICD-QualityGates.md`
- `docs/03-詳細設計/3.非機能詳細/DD-UX-Accessibility-TestPlan.md`

## 前提/環境
- テストフレームワーク: Playwright
- 実行環境: stg相当（テストデータ投入済み）
- 対象ブラウザ: Chrome/Edge/Safari/Firefox 最新2世代（PC-002）

## テスト観点
- 画面遷移/認可
- 主要UI操作（入力/検索/フィルタ/共有/削除）
- API連携結果（一覧/詳細/エラー）
- アクセシビリティ通知（role="status"/"alert", aria-live）
- セッション/ローカルストレージ

## テストケース一覧

### 認証（UC-01, FR-AUTH-001/002/003）
| ID | シナリオ | 前提 | 手順 | 期待結果 |
| --- | --- | --- | --- | --- |
| IT-AUTH-001 | 新規登録 | 未登録ユーザー | signup.htmlで登録 | 登録後にnotes.htmlへ遷移し一覧が表示 |
| IT-AUTH-002 | ログイン成功 | 登録済み | login.htmlでログイン | notes.htmlへ遷移、ユーザーメニュー表示 |
| IT-AUTH-003 | ログイン失敗 | 登録済み | 誤PWで送信 | エラー通知が表示（alert） |
| IT-AUTH-004 | パスワードリセット | 登録済み | resetリンクから申請 | 送信完了通知、メール送信ログが残る |
| IT-AUTH-005 | 未ログイン遷移 | 未ログイン | editor.html直接 | login.htmlにリダイレクト |
| IT-AUTH-006 | ログアウト | ログイン済み | logoutBtnを押下 | login.htmlへ遷移、セッション削除 |
| IT-AUTH-007 | セッション復帰 | ログイン済み | login.htmlへ遷移 | notes.htmlへ自動遷移 |

### ノート一覧/検索（UC-02/05, FR-COMMON-003, FR-SEARCH-001）
| ID | シナリオ | 前提 | 手順 | 期待結果 |
| --- | --- | --- | --- | --- |
| IT-NOTES-001 | 一覧表示 | ログイン済み | notes.html表示 | タイトル/更新日時が表示 |
| IT-NOTES-002 | 空状態 | ノート0件 | notes.html表示 | emptyStateが表示、通知あり |
| IT-NOTES-003 | 検索（タイトル） | 複数ノート | 検索語入力 | タイトル一致のノートが残る |
| IT-NOTES-004 | 検索（本文） | 複数ノート | 本文語で検索 | Cue/Notes/Summary一致が残る |
| IT-NOTES-005 | 検索（タグ） | タグあり | tagで検索 | タグ一致のノートが残る |
| IT-NOTES-006 | フィルタ（タグ） | タグあり | タグをクリック | 該当ノートのみ表示 |
| IT-NOTES-007 | フィルタ（ノートブック） | Notebookあり | Notebookクリック | 該当ノートのみ表示 |
| IT-NOTES-008 | ページング | 100件超 | 次ページ操作 | 件数とページが更新 |

### ノート編集/自動保存（UC-03, FR-COMMON-001/002, FR-EDIT-001〜004）
| ID | シナリオ | 前提 | 手順 | 期待結果 |
| --- | --- | --- | --- | --- |
| IT-EDIT-001 | 新規作成 | ログイン済み | newNoteBtn → editor | 空フォームが表示 |
| IT-EDIT-002 | Cue保存 | 既存ノート | Cue入力 → 自動保存 | 保存ステータスが更新され、再読込で一致 |
| IT-EDIT-003 | Notes保存 | 既存ノート | Notes入力 → 自動保存 | 再読込で一致 |
| IT-EDIT-004 | Summary保存 | 既存ノート | Summary入力 → 自動保存 | 再読込で一致 |
| IT-EDIT-005 | タイトル反映 | 既存ノート | タイトル変更 | notes.htmlと検索結果に反映 |
| IT-EDIT-006 | タグ追加/削除 | 既存ノート | tagInputで操作 | タグ表示が更新 |
| IT-EDIT-007 | ノートブック変更 | 既存ノート | notebookSelect変更 | notes.htmlのフィルタに反映 |
| IT-EDIT-008 | 共有リンク生成 | 既存ノート | shareBtn → 生成 | share.htmlのURLが表示 |
| IT-EDIT-009 | 共有リンク無効化 | 共有リンク有効 | 無効化操作 | 再訪でエラー表示 |
| IT-EDIT-010 | 削除 | 既存ノート | deleteBtnで削除 | notes.htmlへ戻り一覧から消える |

### 共有閲覧（UC-07, FR-SHARE-001/002）
| ID | シナリオ | 前提 | 手順 | 期待結果 |
| --- | --- | --- | --- | --- |
| IT-SHARE-001 | 共有閲覧 | 共有リンクあり | share.htmlを開く | 未ログインでも閲覧できる |
| IT-SHARE-002 | 共有無効 | 共有リンク無効化 | share.htmlを再訪 | エラー表示/通知 |
| IT-SHARE-003 | トークン無し | トークンなしURL | share.htmlを開く | エラー状態が表示 |
| IT-SHARE-004 | アクセス不能トークン | 期限切れ/削除 | share.htmlを開く | 410相当の表示 |

### PDFエクスポート（UC-06, FR-EXPORT-001）
| ID | シナリオ | 前提 | 手順 | 期待結果 |
| --- | --- | --- | --- | --- |
| IT-EXPORT-001 | PDF生成 | 既存ノート | exportBtnをクリック | 進捗通知後にPDF取得が可能 |
| IT-EXPORT-002 | PDF内容 | PDF取得 | 生成PDFを開く | Cue/Notes/Summaryが欠落しない |
| IT-EXPORT-003 | PDF失敗 | 生成失敗 | exportBtnをクリック | エラー通知/再試行案内 |

### セキュリティ/分離（PC-003）
| ID | シナリオ | 前提 | 手順 | 期待結果 |
| --- | --- | --- | --- | --- |
| IT-SEC-001 | 他ユーザーID参照 | 別ユーザー | 他者ノートIDで編集URL | アクセス不可（404/403） |
| IT-SEC-002 | 共有リンク例外 | 共有リンクあり | 未ログイン閲覧 | 共有ノートのみ閲覧可 |

## 期待成果物
- Playwrightレポート/スクリーンショット/動画
- 対象ブラウザごとの結果ログ（PC-002）
- 失敗時のNetwork Trace
