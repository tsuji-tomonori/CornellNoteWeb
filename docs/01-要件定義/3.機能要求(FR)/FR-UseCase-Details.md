# 3.2 個別ユースケース（基本フロー／代替・例外／事前・事後条件）

表記ルール：
- **基本フロー**：成功する標準的な流れ
- **代替フロー（Axx）**：条件付きの別ルート
- **例外（Exx）**：失敗・エラー

---

## UC-01 サインアップ／ログイン

- **主アクター**：A1（ノート作成者）
- **トリガー**：ユーザーが「ログイン」または「新規登録」を選択する
- **事前条件**：なし
- **成功時事後条件**：ユーザーのセッションが確立され、個人領域へ遷移できる
- **失敗時事後条件**：未認証のまま。個人領域は閲覧不可

### 基本フロー
1. ユーザーはログイン画面を表示する。
2. ユーザーはメールアドレスとパスワードを入力し「ログイン」を押す。
3. システムは認証情報を検証する。
4. システムはセッションを開始し、ノート一覧へ遷移する。

### 代替フロー
- **A01: 新規登録**
  1. ユーザーは「新規登録」を選択する。
  2. ユーザーはメール、パスワードを入力し登録する。
  3. システムはユーザーを作成し、ログイン状態にする。
- **A02: OAuth ログイン**
  1. ユーザーは「Google でログイン」を選択する。
  2. システムは外部認証プロバイダへリダイレクトする。
  3. 外部認証プロバイダは認可結果を返す。
  4. システムはユーザーを特定しログイン状態にする。

### 例外
- **E01: 認証失敗**  
  3 で失敗した場合、システムはエラーメッセージを表示し、2 に戻る。
- **E02: 外部認証エラー**  
  A02 で外部認証が失敗した場合、システムは失敗理由（可能な範囲）を表示しログイン画面へ戻る。

---

## UC-02 コーネル式ノート作成

- **主アクター**：A1
- **トリガー**：「新規ノート」を押下
- **事前条件**：ログイン済み
- **成功時事後条件**：空の Cornell ノートが作成され、編集画面が表示される
- **失敗時事後条件**：ノートは作成されない

### 基本フロー
1. ユーザーはノート一覧で「新規ノート」を押す。
2. システムはノート作成ダイアログを表示する（タイトル、ノートブック、テンプレート等）。
3. ユーザーはタイトル等を入力し「作成」を押す。
4. システムは Cornell 形式（Cue／Notes／Summary）を持つノートを作成する。
5. システムはノート編集画面を表示する。

### 代替フロー
- **A01: タイトル未入力**  
  3 でタイトルが空の場合、システムは自動タイトル（例：無題＋作成日時）で作成してもよい。

### 例外
- **E01: 保存領域エラー**  
  4 で永続化に失敗した場合、システムは作成失敗を通知し、一覧に戻る。

---

## UC-03 コーネル式ノート編集

- **主アクター**：A1
- **トリガー**：ノートを開く／編集する
- **事前条件**：ログイン済み、対象ノートが存在する
- **成功時事後条件**：編集内容が保存される
- **失敗時事後条件**：保存できなかった編集は未確定（再試行可能）

### 基本フロー
1. ユーザーはノート一覧から対象ノートを開く。
2. システムは Cornell レイアウト（Cue／Notes／Summary）を表示する。
3. ユーザーは各領域にテキストを入力・編集する。
4. システムは編集を自動保存する（または明示保存）。
5. システムは保存状態（保存済み／未保存／エラー）を表示する。

### 代替フロー
- **A01: 明示保存**  
  4 の代わりに、ユーザーが「保存」操作を行ったときに保存する。
- **A02: コーネル構造の補助入力（将来）**  
  ユーザーが Notes の一部を選択して「Cue に要約」等を実行した場合、システムは Cue に項目を生成する（任意機能）。

### 例外
- **E01: ネットワーク断**  
  4 で通信できない場合、システムはローカルに編集中状態を保持し、復旧後に再送を試みる（実装方針による）。
- **E02: 同時編集衝突**  
  同一ノートを複数端末で編集して衝突した場合、システムは衝突を通知し、解決手段（後勝ち／差分マージ／履歴から復元等）を提供する（MVP では「後勝ち」でも可）。

---

## UC-04 ノート整理（ノートブック／タグ）

- **主アクター**：A1
- **トリガー**：ノートに分類情報を付けたい
- **事前条件**：ログイン済み
- **成功時事後条件**：ノートが指定のノートブック／タグに紐づく

### 基本フロー
1. ユーザーはノート一覧または編集画面で「ノートブック」「タグ」を編集する。
2. システムは候補（既存）を提示し、新規作成も許可する。
3. ユーザーは分類を確定する。
4. システムは分類を保存し一覧へ反映する。

### 例外
- **E01: タグ名不正**  
  禁則文字や長すぎる場合、システムは入力エラーを返す。

---

## UC-05 ノート検索

- **主アクター**：A1
- **トリガー**：検索窓に入力
- **事前条件**：ログイン済み
- **成功時事後条件**：該当ノートが一覧表示される

### 基本フロー
1. ユーザーは検索キーワードを入力する。
2. システムはタイトル／Cue／Notes／Summary／タグを対象に検索する。
3. システムは検索結果を表示する。
4. ユーザーは結果からノートを開く。

### 代替フロー
- **A01: 絞り込み検索**  
  タグ、ノートブック、更新日で絞り込みを行う。

---

## UC-06 PDF エクスポート／印刷

- **主アクター**：A1
- **トリガー**：「PDF にエクスポート」「印刷」
- **事前条件**：ログイン済み、対象ノートが存在
- **成功時事後条件**：PDF が生成されダウンロードできる、または印刷ダイアログが開く

### 基本フロー（PDF）
1. ユーザーはノート編集画面で「PDF エクスポート」を選ぶ。
2. システムは PDF を生成する。
3. システムはダウンロードを開始する。

### 例外
- **E01: 生成失敗**  
  システムは失敗を通知し再試行を促す。

---

## UC-07 共有リンクで閲覧共有

- **主アクター**：A1（作成者）、A2（閲覧者）
- **トリガー**：作成者が「共有」を押す
- **事前条件**：A1 はログイン済み、対象ノートが存在
- **成功時事後条件**：共有 URL が発行され、A2 が閲覧可能になる（編集不可）

### 基本フロー
1. A1 は「共有リンクを作成」を選択する。
2. システムは共有 URL（トークン付き）を発行し表示する。
3. A2 は URL にアクセスする。
4. システムはノートを閲覧専用で表示する。

### 代替フロー
- **A01: 共有停止**  
  A1 が共有を無効化した場合、以後 A2 のアクセスは拒否される。

### 例外
- **E01: 共有トークン無効**  
  システムは「閲覧できない」旨を表示する。

---

## UC-08 アカウント管理

- **主アクター**：A1
- **トリガー**：設定画面を開く
- **事前条件**：ログイン済み
- **成功時事後条件**：設定が更新される、または退会処理が完了する

### 基本フロー
1. ユーザーはプロフィール（表示名等）を更新する。
2. システムは更新内容を保存する。

### 代替フロー
- **A01: 退会（アカウント削除）**  
  ユーザーが退会を選ぶと、システムは確認の上で退会処理を行う（論理削除／猶予期間は方針による）。
