# 可観測性設計（NFR-OPS）

## 対応NFR
- NFR-OPS-001 集中ログと相関ID
- NFR-OPS-002 SLI/SLO監視と可視化
- NFR-OPS-003 アラート通知とエスカレーション（月次通知テスト、冗長経路）
- NFR-OPS-004 ランブックとポストモーテム（Should）
- NFR-OPS-005 ヘルスチェック（Liveness/Readiness）
- NFR-OPS-006 メトリクス収集（RED/USE、30日保持）
- NFR-OPS-007 分散トレーシング（Should）
- NFR-OPS-008 エラーバジェット運用（Could）
- NFR-OPS-009 時刻同期（ずれ1秒以内）

## ログ（OPS-001）
- アプリ/基盤ログは集中管理
- traceId（相関ID）を必須フィールドとして全リクエストに付与・伝播
- PIIはマスキング（NFR-PRC-002）し、生PIIはログ禁止

## SLI/SLO（OPS-002）
- 可用性・遅延・エラー率・スループットをSLIとして定義
- ダッシュボードでSLO達成状況を閲覧可能にする
- 定義（対象/除外条件/集計方法）を文書化する

## アラート/エスカレーション（OPS-003）
- 重大アラートは通知経路を冗長化（例：チャット＋電話＋メール）
- 月次で通知テストを実施し到達確認
- アラートは「原因」ではなく「ユーザー影響（SLO）」に紐づける

## ランブック/ポストモーテム（OPS-004）
- 主要障害シナリオの復旧手順（ランブック）を整備
- 重大障害は100%ポストモーテムを保存（再発防止を目的）

## ヘルスチェック（OPS-005）
- LivenessとReadinessを分離
- 依存サービス不調時はReadinessを落として切り離し可能にする（AV-003と整合）

## メトリクス（OPS-006）
- RED（Rate/Errors/Duration）とUSE（Utilization/Saturation/Errors）を主要コンポーネントで収集
- 30日以上保持し、容量計画・性能改善に利用

## トレーシング（OPS-007）
- トレースコンテキストをサービス間で伝播
- 主要ユースケースで単一トレースとして可視化

## エラーバジェット（OPS-008）
- SLOに基づくエラーバジェット算定を定義
- 超過時は変更凍結/品質改善を優先（DEV-002/003と調整）

## 時刻同期（OPS-009）
- 全ノードが信頼できる時刻源へ同期
- ずれは監視し、常時1秒以内を維持
