# セキュリティ設計（NFR-SEC）

## 対応NFR
- NFR-SEC-001 最小権限
- NFR-SEC-002 特権アクセス（MFA/条件付き）
- NFR-SEC-003 ネットワーク境界防御
- NFR-SEC-004 通信暗号化（TLS1.2+）
- NFR-SEC-005 保存データ暗号化（データ分類NFR-PRC-001に依存）
- NFR-SEC-006 シークレット管理（平文禁止）
- NFR-SEC-007 脆弱性管理（Criticalは7日以内に修正/緩和）
- NFR-SEC-008 セキュリティ監視とIR
- NFR-SEC-009 セキュリティベースライン準拠（構成コンプライアンス）
- NFR-SEC-010 鍵/証明書ローテーション（鍵：年1回、証明書：期限前自動更新、30日前アラート）
- NFR-SEC-011 WAF/DDoS防御
- NFR-SEC-012 サプライチェーン（SBOM/署名/検証）

## 目的
不正アクセス/情報漏えい/改ざん/DoS等のリスクを低減し、監査可能な形で継続運用できる状態を作る。

## IAM/認証（SEC-001, SEC-002）
- 利用者/サービスアカウント/運用者をロール分離し、最小権限を原則
- 特権操作はMFA必須、条件付きアクセス（端末/場所/時間など）を適用
- 例外（緊急対応）は申請/期限/事後レビューを必須にする

## ネットワーク境界（SEC-003）
- DB/管理系IFはプライベートネットワークに閉じる
- 外部公開面はAPI Gateway (HTTP API) + WAFで防御し、到達経路を限定
- 運用アクセスは踏み台/限定経路を前提（証跡を残す）

## 暗号化（SEC-004, SEC-005, SEC-010）
- 通信: TLS1.2以上（外部/内部）
- 保管: 機密データは暗号化（KMS等の鍵管理を前提）
- 鍵/証明書: 有効期限管理、ローテーション、期限前アラート（30日前）

## シークレット管理（SEC-006）
- シークレットは一元管理（アクセス制御＋監査ログ）
- リポジトリ/CIで混入スキャンを実施（検出時はビルド失敗）

## 脆弱性管理（SEC-007）
- OS/依存ライブラリ/コンテナの継続スキャン
- Criticalは7日以内に修正/緩和（チケットで追跡）

## セキュリティ監視（SEC-008）
- 監査対象: 認証、権限変更、重要データアクセス、設定変更
- 検知: ルール化してアラート（NFR-OPS-003と統合）
- 記録: 監査証跡は改ざん困難＋1年以上保管（NFR-PRC-004と整合）

## 構成コンプライアンス（SEC-009）
- セキュリティベースラインをポリシーとして管理（公開禁止/暗号化必須/ログ有効等）
- 日次評価し、逸脱はチケット化または自動是正
- IaC（NFR-DEV-001）と整合させ「手作業変更＝逸脱」とする

## WAF/DDoS（SEC-011）
- インターネット公開エンドポイントにWAFルール（SQLi/XSS等の基本）を適用
- 誤検知による可用性影響（NFR-AV-001）を踏まえ、例外運用/段階導入を用意

## サプライチェーン（SEC-012）
- コンテナ等成果物にSBOM生成
- 成果物署名＋デプロイ時検証（検証失敗はデプロイ不可）
- CI/CD（NFR-DEV-002）に組み込み
